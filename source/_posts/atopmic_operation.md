---
title: 原子操作
categories:
- 聊天室
- 多线程
tags: [聊天室,pthread]
date: 2022-05-12 20:45:00
---
### 原子操作
原子操作的概念有助于理解可重入性、临界区、线程安全、同步原语等。
<!--more-->

### 原子性
原子性就是指不可破坏性，也就是不间断的操作，要么全部执行成功，要么全部执行失败。

比如此时A寝室有5人，B寝室有3人，现在A寝室中的一人要去B寝室游玩，那么该发生的事情有

1、A寝室人数减1，变成4人，B寝室人数加1，变成4人，此时行动成功哦你。
2、发生意外情况，比如A寝室的人到达B寝室后发现B寝室锁门，那么操作就要进行回滚（A寝室出去的人要重新回到A寝室）。此时A寝室仍有5人，B寝室仍有3人。

我们把一个事务看作一个程序，它要么完整的被执行，要么完全不执行，那么我们就称这个事务具有原子性。

下面通过一个例子来介绍编程中的原子性。考虑在的多线程应用程序中，一个函数正在递增一个全局/静态变量。
	
	count++; //count在RAM中永久存储
上述语句可以被分解为三个操作

1.  获取`count`的值
2. 递增`count`的值
3. 存储更新后的值

如果执行包含上述语句的函数的线程正在获取`count`的值（例如此时`count`值为2），线程在这个执行点可能被抢占，另一个线程可能会同时调用此函数。随后，`count`的值被另一个线程增加到3。到了当前线程恢复时，当前线程中的`count`仍然保留之前的值2，而不是被另一个线程操作过后的值3,因此`count`的值又被写回3而不是4。这种错误很难复现和定位。


>引用
https://www.geeksforgeeks.org/g-fact-57/
https://www.cnblogs.com/deepalley/p/10795389.html